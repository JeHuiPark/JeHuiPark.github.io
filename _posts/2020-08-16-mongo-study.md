---
layout: posts
title:  몽고 기초 공부
date:   2020-08-16 13:00:00 +0900
comments: true
categories: study
---

* TOC
{:toc}

## 인덱스
단일 값이나 단일 필드는 인덱스를 생성해도 필드의 이름이 인덱스에 저장되지 않고 인덱스의 메타 정보에서만 관리되므로, 인덱스의 크기에는 영향을 미치지 않는다.  
하지만 서브 도큐먼트를 값으로 가지는 필드는 그 서브 도큐먼트의 자식 필드 이름이 모두 인덱스에 저장되므로 자식 필드의 이름이 길면 그만큼 인덱스의 크기에 영향을 미친다.  
서브 도큐먼트의 필드명이 길 때에는 이 값들이 인덱스의 크기를 훨씬 더 크게 만드는 역효과를 만들기도 한다.

WiredTiger 스토리지 엔진은 데이터 파일은 기본적으로 압축을 적용하지만, 인덱스 데이터 파일은 압축을 하지 않는다. 

서브 도큐먼트 필드에 대해서 생성되는 인덱스를 사용하려면 조건절에 서브 도큐먼트의 필드를 모두 가지고, 순서가 같을 때만 인덱스를 활용할 수 있다.

### 컴파운드 인덱스

인덱스의 N번째 컬럼은 N-1번째 컬럼이 같은 레코드 내에서 다시 정렬된다. 그렇기 때문에 인데스 내에서 각 필드의 순서는 상당히 중요하며, 신중하게 결정해야 한다.

해시 인덱스는 컴파운드 인덱스에서 사용할 수 없다.

아래와 같은 도큐먼트가 있을 때
```json
{
    "field1" : {
       "field1_1" : 111,
       "field1_2" : "aaa",
    },
    "field2" : "2020-08-16",
    "field3" : "박제희"
}
```

- 인덱스가 하나의 필드를 가지면 단일 필드라고 정의한다. 여기서 단일 필드는 서브 도큐먼트도 포함한다.  
    복합 필드 인덱스는 서브 도큐먼트의 필드도 포함할 수 있으며, 1레벨과 서브 도큐먼트의 필드와 혼용하는 것도 가능하다.
    - `field1` 를 지정하면 단일 필드이다.  
    - `field2` 를 지정하면 단일 필드이다.
- 인덱스가 복수의 필드를 가지면 복합 필드라고 정의한다. (컴파운드 인덱스 혹은 컴포지트 인덱스)
    - `field1` 과 `field2` 를 지정하면 복합 필드이다.
    - `field1.field1_1` 과 `field1.field1_2` 를 지정하면 복합 필드이다.
    - `field1.field1_1` 과 `field3` 를 지정하면 복합 필드이다.
    
서브 도큐먼트를 갖는 필드(`field1`) 를 대상으로 단일 인덱스 (`idx1`) 를 생성했을 때와 복합 인덱스(`idx2`)를 생성했을 때는 어떤 차이점이 존재할까?  
EX)  
- `idx1`: `field1` 필드를 갖는 단일 인덱스
- `idx2`: `field1.field1_1` 과 `field1.field1_2` 필드를 갖는 복합 인덱스

`idx1` 는 `field1` 에 어떤 서브 도큐먼트가 저장되든 **BSON** 으로 변환하여 인덱스 키 엔트리로 사용한다.  
`idx2` 는 `field1` 에 저장되는 서브 도큐먼트가 어떤 필드를 가지던지 관계없이 인덱스에 명시한 서브 필드의 조합으로 컴파운드 인덱스를 생성한다.



