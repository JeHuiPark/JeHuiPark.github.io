<!doctype html> <!-- Minimal Mistakes Jekyll Theme 4.12.0 by Michael Rose Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes Free for personal and commercial use under the MIT license https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt --><html lang="ko" class="no-js"><head><meta charset="utf-8"> <!-- begin _includes/seo.html --><title>Github Action 을 이용하여 Github 블로그 배포하기 - JH Blog</title><meta name="description" content="developer JH website."><meta property="og:type" content="article"><meta property="og:locale" content="ko_KR"><meta property="og:site_name" content="JH Blog"><meta property="og:title" content="Github Action 을 이용하여 Github 블로그 배포하기"><meta property="og:url" content="https://jehuipark.github.io/note/blog-publish-with-github-action"><meta property="og:description" content="developer JH website."><meta property="article:published_time" content="2020-02-29T22:00:00+09:00"><meta property="fb:app_id" content="150481385751381"><link rel="canonical" href="https://jehuipark.github.io/note/blog-publish-with-github-action"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Person", "name": "Dev JH", "url": "https://jehuipark.github.io", "sameAs": null } </script><meta name="google-site-verification" content="googlece77ee37e1eecdba" /><meta name="naver-site-verification" content="naver4b9c5fbe228f7d5fc4264f265fee743a"> <!-- end _includes/seo.html --> <!--<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="JH Blog Feed">--><link rel="alternate" type="application/rss+xml" href="https://jehuipark.github.io/feed.xml" title="JH Blog Feed"> <!-- https://t.co/dKP3o1e --><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script> document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js '; </script> <!-- For all browsers --><link rel="stylesheet" href="/assets/css/main.css"> <!--[if IE ]><style> /* old IE unsupported flexbox fixes */ .greedy-nav .site-title { padding-right: 3em; } .greedy-nav button { position: absolute; top: 0; right: 0; height: 100%; }</style><![endif]--> <script src="/assets/js/highlight.js"></script> <script src="/assets/js/highlightjs-line-numbers.min.js"></script> <!-- start custom head snippets --> <!--<link href="/assets/css/railscasts.css" rel="stylesheet" type="text/css">--><link href="/assets/css/zenburn.css" rel="stylesheet" type="text/css"> <!-- insert favicons. use https://realfavicongenerator.net/ --> <!-- end custom head snippets --><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body class="layout--posts"> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/">JH Blog</a><ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/" >about</a></li><li class="masthead__menu-item"> <a href="/categories" >category</a></li><li class="masthead__menu-item"> <a href="/tags" >tag</a></li></ul><button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16"><path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path> </svg> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">토글 메뉴</span><div class="navicon"></div></button><ul class="hidden-links hidden"></ul></nav></div></div></div><div class="initial-content"><div id="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="https://schema.org/Person"><div class="author__avatar"> <img src="/assets/images/me.jpg" alt="JeHui Park" itemprop="image"></div><div class="author__content"><h3 class="author__name" itemprop="name">JeHui Park</h3><p class="author__bio" itemprop="description"> 개발자 박제희</p></div><div class="author__urls-wrapper"> <button class="btn btn--inverse">팔로우</button><ul class="author__urls social-icons"><li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Seoul, Korea</span></li><li> <a href="https://jehuipark.github.io" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i> 웹사이트 </a></li><li> <a href="mailto:pjh2359@gmail.com"><meta itemprop="email" content="pjh2359@gmail.com" /> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> 이메일 </a></li><li> <a href="https://github.com/JeHuiPark" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub </a></li><!--<li> <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link </a></li>--></ul></div></div></div><div class="archive"><h1 id="page-title" class="page__title">Github Action 을 이용하여 Github 블로그 배포하기</h1><ul id="markdown-toc"><li><a href="#시작하기-전에" id="markdown-toc-시작하기-전에">시작하기 전에</a></li><li><a href="#github-action-이-딱이네" id="markdown-toc-github-action-이-딱이네">Github Action 이 딱이네</a><ul><li><a href="#github-action-은" id="markdown-toc-github-action-은"><code class="highlighter-rouge">Github Action</code> 은</a></li></ul></li><li><a href="#github-action-을-만들어보자" id="markdown-toc-github-action-을-만들어보자">Github Action 을 만들어보자</a><ul><li><a href="#github-action-생성" id="markdown-toc-github-action-생성">Github Action 생성</a></li><li><a href="#github-action-몸빵으로-배우기" id="markdown-toc-github-action-몸빵으로-배우기">Github Action 몸빵으로 배우기</a></li></ul></li><li><a href="#완성된-github-action-dsl" id="markdown-toc-완성된-github-action-dsl">완성된 Github Action DSL</a></li></ul><h2 id="시작하기-전에">시작하기 전에</h2><p>Github Action을 이용하기 전에 나는 블로그를 이런식으로 운영하고 있었다.</p><ul><li>블로그의 빌드방식을 github 의존 방식이 아닌 로컬 빌드방식을 이용</li><li>블로그를 배포하는 방법으로 루비 Rakefile 스크립트 이용</li><li>블로그 개발환경을 도커로 구성<blockquote><p><a href="https://jehuipark.github.io/blog/blog-publish">배포 자동화</a><br /> <a href="https://jehuipark.github.io/blog/blog-env-setting-with-docker">블로그 개발환경 도커로 구성하기</a></p></blockquote></li></ul><p>블로그 개발환경을 도커 구성으로 변경하면서, 기존 배포방식에 문제가 발생 하면서 문제점이 보이기 시작했다.</p><p>배포를 Rakefile 태스크에 의존하다 보니, 배포 또한 도커를 이용하게 되었는데 컨테이너 환경에서는 github 에 <code class="highlighter-rouge">push</code> 하기 위한 권한이 없기 때문에 아래와 같은 추가적인 작업이 필요한 상황이 발생한 것이다.</p><ul><li>basic credentials 으로 직접 로그인 - <strong>귀찮음</strong></li><li>컨테이너에 ssh 설정 - <strong>배포환경이 달라질 때 마다 설정을 해줘야 함</strong></li></ul><p>결정적으로 나는 <strong>개발환경 구축이 되어 있지 않더라도, 배포가 가능한 환경을 원했다.</strong><br /> 이런 환경이라면, 단순한 수정은 인터넷만 가능하다면 퀵 하게 처리가 가능할 테니까</p><h2 id="github-action-이-딱이네">Github Action 이 딱이네</h2><p>내 요구사항을 처리하기에 딱 좋은 녀석은 얼마전에 회사에서 공유 받은적이 있는 <code class="highlighter-rouge">Github Action</code> 이 딱이라고 생각하였다.<br /> 나도 <code class="highlighter-rouge">Github Action</code> 을 사용해본 경험은 없기 때문에, 사전조사를 간략하게 진행 하였다.</p><h3 id="github-action-은"><code class="highlighter-rouge">Github Action</code> 은</h3><ol><li>깃헙 레파지토리에서 발생하는 이벤트를 받아서 처리할 수 있게 인터페이스 제공</li><li>레파지토리별 가상 서버를 깃헙에서 제공<ul><li>자체 호스팅 서버를 이용도 가능</li></ul></li><li>깃헙에서 제공하는 가상서버에는 해당 레파지토리에 대한 접근권한 설정이 미리 되어있는 상태<br /> <code class="highlighter-rouge">GITHUB_TOKEN</code> 을 이용한다고 한다.</li></ol><p>이 정도의 정보를 갖고 행동으로 옮겼고, 삽질 끝에 배포 자동화 환경을 구축했다.</p><p>배포 과정을 요약하면 이렇다.</p><ol><li>github 저장소의 <code class="highlighter-rouge">work</code> 브랜치에 <code class="highlighter-rouge">push</code>를 한다.</li><li>원격지에서 <code class="highlighter-rouge">빌드</code>를 수행한다.</li><li><code class="highlighter-rouge">빌드</code> output을 github 저장소의 <code class="highlighter-rouge">master</code> 브랜치에 <code class="highlighter-rouge">push</code> 한다. (<strong>배포완료</strong>)</li></ol><h2 id="github-action-을-만들어보자">Github Action 을 만들어보자</h2><h3 id="github-action-생성">Github Action 생성</h3><p><img src="https://user-images.githubusercontent.com/25237661/75607351-8b816d00-5b39-11ea-9a42-447925b85cbe.png" alt="image" /></p><p>생성 버튼을 누르니 깃헙설정 경로에 <code class="highlighter-rouge">yml</code> 파일이 생성되는 걸 보니 <strong>DSL</strong> 의 느낌이 온다. 그래서 <a href="https://help.github.com/en/actions">Github Action Help</a> 레퍼런스를 잠깐 읽었는데 머리도 아프고 역시 몸빵이 최고인 것 같아서 레퍼런스를 켜두고 일단 시작했다.</p><p><a href="https://help.github.com/en/actions">Github Action Help</a> 어디에선가 발췌한 Hello World 스크립트를 갖고 바로 몸빵을 시작하기로 결정했다.</p><p><strong>Hello World 스크립트</strong></p><div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Greet Everyone</span>
<span class="c1"># This workflow is triggered on pushes to the repository.</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="c1"># Job name is Greeting</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Greeting</span>
    <span class="c1"># This job runs on Linux</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># This step uses GitHub's hello-world-javascript-action: https://github.com/actions/hello-world-javascript-action</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Hello world</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/hello-world-javascript-action@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">who-to-greet</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Mona</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Octocat'</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">hello</span>
      <span class="c1"># This step prints an output (time) from the previous step's action.</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Echo the greeting's time</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">echo 'The time was $.'</span>
</code></pre></div></div><h3 id="github-action-몸빵으로-배우기">Github Action 몸빵으로 배우기</h3><p>깃헙 액션을 몸빵으로 체득하다 보면 커밋 히스토리가 지저분해질게 뻔히 보여서 일단 리모트 <strong>브랜치를 분리</strong>하는 작업을 먼저 진행 하였다.</p><blockquote><p>work-flow-test 브랜치 생성</p></blockquote><p>분리된 브랜치에서 깃헙액션 DSL 을 생성하고, 사전에 찾아뒀던 Hello World 스크립트를 저장하였다.<br /> 저장하는 순간 github 에 push 이벤트가 발생하였고, 아래와 같이 깃헙 액션 실행결과를 확인할 수 있었다.<br /> <img src="https://user-images.githubusercontent.com/25237661/75607494-20389a80-5b3b-11ea-901c-e98d3204e967.png" alt="image" /></p><p>깃헙액션의 실행결과를 눈으로 확인하고 나서 바로 든 생각은 <em><code class="highlighter-rouge">신기하네 약간 도커같은 느낌인걸?</code></em> 이였다.</p><p>그리고 job 의 <code class="highlighter-rouge">step</code> 을 하나씩 단계별로 구성하면 내가 하려던 작업을 충분히 할 수 있겠다고 직감했고 깃헙 액션을 조금씩 채워나가기 시작했다.</p><ol><li>소스 체크아웃 <code class="highlighter-rouge">step</code> 만들기 이런저런 삽질을 해보다가 이정도는 이미 만들어져 있지 않을까 해서 찾아보니 <a href="https://github.com/actions/checkout">깃헙에서 제공</a>하고 있어서 그걸 사용했다.</li><li>ruby 설치하기 <code class="highlighter-rouge">step</code> 만들기 지킬 블로그는 ruby 패키지에 의존하여 동작하기 때문에 필수적으로 필요한 요소이다.<br /> 이것도 <a href="https://github.com/actions/setup-ruby">깃헙에서 제공</a>한다.</li><li>gem 설치하기 <code class="highlighter-rouge">step</code> 만들기<br /> 지킬 블로그에 빌드에 필요한 gem 을 설치해야 한다. (내 로컬과 동일하게)<br /> 여기서 삽질을 좀 했다.<ol><li><code class="highlighter-rouge">Gemfile.lock</code>이 존재하지 않아서 gem 설치가 순서대로 되지 않아서 오류 발생</li><li>젬 디펜던시 설치가 너무 오래 걸림 (액션이 돌때마다 새로 설치)<br /> 이에 대한 솔루션도 <a href="https://github.com/actions/cache">깃헙에서 제공</a>하고 있어서 몇번 삽질 후에 성공적으로 적용하였다.</li></ol></li><li>블로그 빌드 <code class="highlighter-rouge">step</code> 만들기<br /> <a href="https://github.com/actions/cache">기존에 프로덕션 배포시 사용하던 Rakefile을 일부 활용</a>하였다. <code class="highlighter-rouge">rake site:generate</code></li><li>블로그 배포 <code class="highlighter-rouge">step</code> 만들기<br /> 쉘 스크립트 작성에 능숙치 못해서 여기에서 가장 많은 시간을 소요했다<br /> 대충 요악하면 여기에서 진행하려고 하던 작업은 이렇다.<ol><li>블로그 빌드 결과물을 임시 디렉토리로 이동</li><li>작업 브랜치를 <code class="highlighter-rouge">master</code> 브랜치로 이동</li><li>블로그 빌드 결과물 적용</li><li>변경사항 <code class="highlighter-rouge">commit</code></li><li><code class="highlighter-rouge">commit</code> 내용을 github 저장소의 <code class="highlighter-rouge">master</code> 브랜치로 push</li></ol></li></ol><h2 id="완성된-github-action-dsl">완성된 Github Action DSL</h2><p>내가 삽질하면서 작성한 Github Action DSL 은 <a href="https://github.com/JeHuiPark/JeHuiPark.github.io/pull/3">여기서</a> 확인할 수 있다.</p><p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong> <span itemprop="keywords"> <a href="/tags/#github" class="page__taxonomy-item" rel="tag">github</a> </span></p><a href="#page-title" class="back-to-top">Back to Top &uarr;</a><div class="page__comments"><h4 class="page__comments-title">댓글남기기</h4><section id="disqus_thread"></section></div></div></div></div><div class="search-content"><div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="검색어를 입력해주세요..." /><div id="results" class="results"></div><h3>우측 상단의 돋보기를 누르면 원래 화면으로 돌아갈 수 있습니다.</h3></div></div><div class="page__footer"><footer> <!-- start custom footer snippets --> <!-- end custom footer snippets --><div class="page__footer-follow"><ul class="social-icons"><li><strong>팔로우:</strong></li><li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li></ul></div><div class="page__footer-copyright">&copy; 2020 Dev JH. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div></footer></div><script src="/assets/js/main.min.js"></script> <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <!-- start custom analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-113477172-1', 'auto'); ga('send', 'pageview'); </script> <!-- end custom analytics snippet --> <script> var disqus_config = function () { this.page.url = "https://jehuipark.github.io/note/blog-publish-with-github-action"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/note/blog-publish-with-github-action"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function() { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://https-jehuipark-github-io-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <script> $(document).ready(function() { $('pre code').each(function(i, block) { try{block.className = block.parentElement.parentElement.parentElement.className.split(' ')[0].replace('language-', '')}catch(e){}; hljs.highlightBlock(block); }); hljs.initLineNumbersOnLoad(); }); </script></body></html>